on:
  push:
    branches:
      - "**"
      - "!main"
  pull_request:
    branches:
      - "development"
      - "!main"

jobs:
    install_dependencies:
      runs-on: ubuntu-20.04

      container:
        image: barichello/godot-ci:4.3
      
      steps:
        - name: Check Godot version
          run: godot --version

        - name: Install GUT (Godot Unit Testing)
          run: |
            git clone https://github.com/bitwes/GutTests.git

    unitTests:
        runs-on: ubuntu-20.04
        needs: install_dependencies
        
        container:
          image: barichello/godot-ci:4.3
        
        steps:
          - name: Checkout repository
            uses: actions/checkout@v4
          
          - name: Run Unit Tests
            run: |
              gut run

          - name: Upload Tests Results
            uses: actions/upload-artifact@v3
            with:
              name: test-results
              path: Test/Unit/test_results.txt
          
          - name: Display Failed Tests
            if: failure()
            run: cat Test/Unit/test_results.txt