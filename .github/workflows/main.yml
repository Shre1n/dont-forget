
name: Godot CI - Install Godot


on:
  push:
    branches:
      - "**"
      - "!main"
  pull_request:
    branches:
      - "development"

jobs:
    install_dependencies:
      runs-on: ubuntu-20.04

      container:
        image: barichello/godot-ci:4.3
      
      steps:
        - name: Check Godot version
          run: godot --version

    unitTests:
        runs-on: ubuntu-20.04
        needs: install_dependencies
        
        container:
          image: barichello/godot-ci:4.3
        
        steps:
          - name: Checkout repository
            uses: actions/checkout@v4

          - name: Headless
            run: |
              godot -e --path dont-forget --no-gui
          
          - name: Run Unit Tests
            run: |
              godot -s addons/gut/gut_cmdln.gd --no-gui -d --path dont-forget -ginclude_subdirs -gdir=res://Test -gexit -gprefix=test_

          - name: Upload Tests Results
            uses: actions/upload-artifact@v3
            with:
              name: test-results
              path: Test/Unit/test_results.txt
          
          - name: Display Failed Tests
            if: failure()
            run: cat Test/Unit/test_results.txt